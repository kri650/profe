<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Professional Calculator — Full Page</title>
  <style>
    :root{
      --bg: #0f1720;
      --text: #dbe9ee;
      --muted: #9aa6b2;
      --accent: #2dd4bf;
      --accent-2: #60a5fa;
      --card: rgba(255,255,255,0.02);
      --sidebar-width: 320px;
      --gap: 18px;
      --radius: 14px;
    }

    /* Reset & base */
    *{box-sizing:border-box}
    html,body{height:100%; margin:0; font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
    body{
      background: linear-gradient(180deg, rgba(7,10,15,1) 0%, rgba(11,18,30,1) 100%);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* Page split: calculator area + sidebar */
    .root {
      min-height:100vh;
      display:flex;
      gap:var(--gap);
      align-items:stretch;
      padding:28px;
    }

    /* Left: big calculator (flexible) */
    .calc-area{
      flex:1 1 auto;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }

    .calculator {
      width: min(1100px, 98%);
      height: calc(100vh - 56px);
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.03));
      border-radius: calc(var(--radius) + 6px);
      padding: 30px;
      box-shadow: 0 6px 22px rgba(2,6,23,0.6);
      gap:28px;
      overflow:hidden;
    }

    .calc-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      width:100%;
      gap:12px;
    }
    .brand { display:flex; align-items:center; gap:12px; }
    .brand .logo{
      width:44px; height:44px; border-radius:10px;
      background:linear-gradient(135deg,var(--accent), var(--accent-2));
      display:flex; align-items:center; justify-content:center;
      font-weight:700; color:#022026; box-shadow: 0 4px 18px rgba(45,212,191,0.12);
    }
    .brand .title{ font-size:1.05rem; color:var(--text); font-weight:600; }
    .brand .subtitle{ font-size:0.8rem; color:var(--muted); margin-top:2px; }

    /* Display card - large */
    .display {
      width:100%;
      max-width: 980px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.015));
      border-radius: 12px;
      padding: 20px 22px;
      display:flex;
      flex-direction:column;
      align-items:flex-end;
      gap:6px;
      box-shadow: inset 0 -6px 30px rgba(0,0,0,0.35);
      border: 1px solid rgba(255,255,255,0.03);
    }
    .display .previous { color:var(--muted); font-size:0.95rem; opacity:0.85; letter-spacing:0.2px; }
    .display .current { font-size:3.6rem; font-weight:600; color:var(--text); line-height:1; word-break:break-all; }

    /* Buttons grid: large tiles */
    .pad {
      width:100%;
      max-width:980px;
      display:grid;
      grid-template-columns: repeat(6, 1fr);
      grid-auto-rows: 92px;
      gap:14px;
      margin-top:6px;
    }

    .btn {
      display:flex;
      align-items:center;
      justify-content:center;
      user-select:none;
      border:none;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.03));
      color:var(--text);
      border-radius: 12px;
      font-size:1.2rem;
      font-weight:600;
      box-shadow: 0 6px 18px rgba(2,6,23,0.45);
      transition: transform 120ms ease, box-shadow 120ms ease, background 140ms ease;
      cursor:pointer;
    }
    .btn:active{ transform: translateY(2px) scale(0.997); }
    .btn:focus{ outline: 2px solid rgba(45,212,191,0.16); outline-offset:3px; }

    .btn-ghost{ background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00)); color:var(--muted); }
    .btn-op{ background: linear-gradient(180deg, rgba(18,27,33,0.7), rgba(4,8,12,0.6)); color:var(--accent); box-shadow: 0 8px 26px rgba(10,22,26,0.6); font-size:1.24rem; letter-spacing:0.6px; }
    .btn-eq{ background: linear-gradient(180deg, var(--accent), var(--accent-2)); color:#021016; font-size:1.25rem; box-shadow: 0 10px 30px rgba(45,212,191,0.12); }
    .btn-clear{ background: linear-gradient(180deg, rgba(255,85,85,0.08), rgba(255,85,85,0.02)); color:#ffb3b3; }
    .btn-back{ background: linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01)); color:var(--muted); }

    .span-2 { grid-column: span 2; }
    .span-3 { grid-column: span 3; }
    .span-4 { grid-column: span 4; }

    /* Right Sidebar */
    .sidebar {
      width: var(--sidebar-width);
      min-width: var(--sidebar-width);
      max-width: var(--sidebar-width);
      background: linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));
      border-left: 1px solid rgba(255,255,255,0.03);
      padding:22px;
      border-radius: 12px;
      height: calc(100vh - 56px);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.02), -8px 0 28px rgba(0,0,0,0.35);
      overflow:auto;
    }
    .sidebar h3 { margin:0 0 14px 0; font-size:1.05rem; color:var(--text); }
    .sidebar .hint { font-size:0.86rem; color:var(--muted); margin-bottom:14px; }

    .history-list { list-style:none; margin:0; padding:0; display:flex; flex-direction:column; gap:10px; }
    .history-item {
      background: linear-gradient(180deg, rgba(255,255,255,0.012), rgba(0,0,0,0.03));
      border-radius:10px;
      padding:12px;
      font-size:0.95rem;
      color:var(--text);
      display:flex;
      flex-direction:column;
      gap:6px;
      border: 1px solid rgba(255,255,255,0.02);
      box-shadow: 0 6px 18px rgba(1,6,12,0.45);
      transition: opacity 0.9s ease, transform 0.9s ease, height 0.9s ease, margin 0.9s ease, padding 0.9s ease;
    }
    .history-item.fading {
      opacity: 0;
      transform: translateX(10px) scale(0.995);
      height: 0;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
    .history-item .time { color:var(--muted); font-size:0.8rem; }

    /* Responsive tweaks */
    @media (max-width: 1100px){
      .pad { grid-template-columns: repeat(4, 1fr); grid-auto-rows: 84px; }
    }
    @media (max-width: 760px){
      .root{ padding:14px; gap:12px; flex-direction:column-reverse; }
      .sidebar{ width:100%; min-width:0; max-width:none; height:auto; border-left:none; border-top:1px solid rgba(255,255,255,0.03); }
      .calculator{ height:auto; padding:18px; gap:16px; }
      .display .current{ font-size:2.6rem; }
      .pad { grid-template-columns: repeat(4,1fr); grid-auto-rows:72px; }
    }

    /* small helper styles */
    .tiny { font-size:0.86rem; color:var(--muted); }
    .muted { color:var(--muted); }

  </style>
</head>
<body>
  <div class="root">
    <!-- Left: Calculator -->
    <div class="calc-area">
      <section class="calculator" aria-label="Professional Calculator">
        <div class="calc-header" role="banner">
          <div class="brand">
            <div class="logo">PC</div>
            <div>
              <div class="title">Professional Calculator</div>
              <div class="subtitle">Formal • Clean • Precise</div>
            </div>
          </div>
          <div class="tiny muted" id="status">Ready</div>
        </div>

        <div class="display" role="status" aria-live="polite">
          <div class="previous" id="prev-display"></div>
          <div class="current" id="curr-display">0</div>
        </div>

        <div class="pad" role="group" aria-label="Calculator Keys">
          <!-- Row 1 -->
          <button class="btn btn-clear span-2" data-action="clear">C</button>
          <button class="btn btn-back" data-action="back">⌫</button>
          <button class="btn btn-op" data-action="op">÷</button>
          <button class="btn btn-op" data-action="op">×</button>

          <!-- Row 2 -->
          <button class="btn" data-action="num">−</button>
          <button class="btn" data-action="num">8</button>
          <button class="btn" data-action="num">9</button>
          <button class="btn btn-op" data-action="op">7</button>
          <button class="btn" data-action="num">4</button>
          <button class="btn" data-action="num">5</button>

          <!-- Row 3 -->
          <button class="btn" data-action="num">6</button>
          <button class="btn" data-action="num">1</button>
          <button class="btn" data-action="num">2</button>
          <button class="btn" data-action="num">3</button>
          <button class="btn btn-eq span-2" data-action="eq">=</button>

          <!-- Row 4 -->
          <button class="btn span-2" data-action="num">0</button>
          <button class="btn" data-action="num">.</button>
          <button class="btn btn-op" data-action="op">+</button>
        </div>
      </section>
    </div>

    <!-- Right: History Sidebar -->
    <aside class="sidebar" aria-label="History Sidebar">
      <h3>Operation History</h3>
      <div class="hint">Recent calculations are shown here — persisted locally. Entries automatically fade after 5 minutes.</div>
      <ul class="history-list" id="history-list" aria-live="polite"></ul>
    </aside>
  </div>

  <script>
    /* ======= State ======= */
    const prevDisplay = document.getElementById('prev-display');
    const currDisplay = document.getElementById('curr-display');
    const status = document.getElementById('status');
    const historyListEl = document.getElementById('history-list');
    const buttons = document.querySelectorAll('.btn');

    let currentOperand = '';
    let previousOperand = '';
    let operation = null;
    let history = JSON.parse(localStorage.getItem('pcalc_history') || '[]'); // {expr, result, timestamp}

    const HISTORY_TTL = 5 * 60 * 1000; // 5 minutes in ms
    const CHECK_INTERVAL = 10 * 1000; // check stale every 10s

    /* ======= Helpers ======= */
    function formatTimeAgo(ts){
      const diff = Date.now() - ts;
      if (diff < 60_000) return 'just now';
      if (diff < 60*60_1000) return Math.floor(diff/60000) + 'm ago';
      if (diff < 24*60*60_1000) return Math.floor(diff/(60*60*1000)) + 'h ago';
      return new Date(ts).toLocaleString();
    }

    function saveHistory(){
      localStorage.setItem('pcalc_history', JSON.stringify(history));
    }

    function pushHistory(expr, result){
      const entry = { expr, result: String(result), timestamp: Date.now() };
      history.unshift(entry);
      // limit to 50 entries (keeps storage small)
      if (history.length > 50) history.length = 50;
      saveHistory();
      renderHistory();
    }

    function renderHistory(){
      historyListEl.innerHTML = '';
      history.forEach((h, idx) => {
        const li = document.createElement('li');
        li.className = 'history-item';
        li.dataset.ts = h.timestamp;
        li.innerHTML = `<div class="expr">${escapeHtml(h.expr)} = <strong>${escapeHtml(h.result)}</strong></div>
                        <div class="time">${formatTimeAgo(h.timestamp)}</div>`;
        historyListEl.appendChild(li);
      });
    }

    function escapeHtml(str){
      return String(str).replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[s]));
    }

    /* ======= Display ======= */
    function updateDisplay(){
      currDisplay.textContent = currentOperand || '0';
      prevDisplay.textContent = previousOperand && operation ? `${previousOperand} ${operation}` : '';
    }

    /* ======= Numeric & Operation Logic ======= */
    function appendNumber(char){
      // prevent multiple leading zeros
      if (char === '0' && currentOperand === '0') return;
      if (char === '.' && currentOperand.includes('.')) return;
      if (char === '.' && currentOperand === '') currentOperand = '0';
      currentOperand += char;
      updateDisplay();
    }

    function chooseOperation(opSymbol){
      // if user pressed op after result (with currentOperand containing result), we proceed
      if (currentOperand === '' && previousOperand === '') return;
      if (previousOperand !== '' && currentOperand !== ''){
        compute();
      }
      if (currentOperand !== ''){
        previousOperand = currentOperand;
        currentOperand = '';
      }
      operation = opSymbol;
      updateDisplay();
    }

    function compute(){
      const prev = parseFloat(previousOperand);
      const curr = parseFloat(currentOperand);
      if (isNaN(prev) || isNaN(curr) || !operation) return;
      let res;
      switch(operation){
        case '+': res = prev + curr; break;
        case '−': res = prev - curr; break;
        case '×': res = prev * curr; break;
        case '÷':
          if (curr === 0){
            res = 'Error';
          } else {
            res = prev / curr;
          }
          break;
        default: return;
      }
      pushHistory(`${prev} ${operation} ${curr}`, res);
      currentOperand = String(res);
      previousOperand = '';
      operation = null;
      updateDisplay();
    }

    function clearAll(){
      currentOperand = '';
      previousOperand = '';
      operation = null;
      currDisplay.textContent = 'Cleared!';
      status.textContent = 'Cleared';
      setTimeout(()=> {
        status.textContent = 'Ready';
        updateDisplay();
      }, 900);
    }

    function backspace(){
      if (currentOperand.length > 0) {
        currentOperand = currentOperand.slice(0, -1);
        updateDisplay();
      }
    }

    /* ======= Button & Keyboard Handling ======= */
    function handleButtonPress(btn){
      const action = btn.dataset.action;
      const text = btn.textContent.trim();

      // visual feedback
      btn.classList.add('active');
      setTimeout(()=> btn.classList.remove('active'), 130);

      if (action === 'num'){
        appendNumber(text);
        return;
      }
      if (action === 'op'){
        // normalize minus sign: ASCII minus vs unicode
        const normalized = text === '−' ? '−' : text; // already correct
        chooseOperation(normalized);
        return;
      }
      if (action === 'eq'){
        compute();
        return;
      }
      if (action === 'clear'){
        clearAll();
        return;
      }
      if (action === 'back'){
        backspace();
        return;
      }
    }

    buttons.forEach(btn => {
      btn.addEventListener('click', (e) => {
        handleButtonPress(btn);
      });
    });

    // Keyboard map: map keys to actions
    document.addEventListener('keydown', (e) => {
      const key = e.key;
      // digits
      if (/^[0-9]$/.test(key)){
        appendNumber(key);
        return;
      }
      if (key === '.' || key === ',') { // allow comma too
        appendNumber('.');
        return;
      }
      if (key === 'Enter' || key === '='){
        e.preventDefault();
        compute();
        return;
      }
      if (key === 'Backspace'){
        e.preventDefault();
        backspace();
        return;
      }
      if (key === 'Escape'){
        clearAll();
        return;
      }
      // operators: map * / - +
      if (['+', '-', '*', '/'].includes(key)){
        e.preventDefault();
        const map = { '+':'+', '-':'−', '*':'×', '/':'÷' };
        chooseOperation(map[key]);
        return;
      }
      // ignore other keys
    });

    /* ======= History TTL and fade-out ======= */
    function pruneHistoryImmediate(){
      const now = Date.now();
      let changed = false;
      // remove entries older than TTL
      history = history.filter(h => {
        if (now - h.timestamp < HISTORY_TTL) return true;
        changed = true;
        return false;
      });
      if (changed) {
        saveHistory();
        renderHistory();
      }
    }

    // Regular check: instead of instant remove, we animate fade then remove
    function checkHistoryFade(){
      const now = Date.now();
      const items = Array.from(historyListEl.children);
      items.forEach(li => {
        const ts = Number(li.dataset.ts);
        if (isNaN(ts)) return;
        const age = now - ts;
        if (age >= HISTORY_TTL){
          // find index in array and remove with animation
          li.classList.add('fading');
          // after animation, remove from DOM and from history array
          setTimeout(() => {
            const idx = history.findIndex(h => h.timestamp === ts);
            if (idx !== -1){
              history.splice(idx,1);
              saveHistory();
            }
            // ensure DOM reconciles
            if (li.parentElement) li.parentElement.removeChild(li);
          }, 900); // matches CSS transition ~0.9s
        } else {
          // update "time ago"
          const timeEl = li.querySelector('.time');
          if (timeEl) timeEl.textContent = formatTimeAgo(ts);
        }
      });
    }

    // run checks on load
    pruneHistoryImmediate();
    renderHistory();
    checkHistoryFade();

    // run periodic checks
    setInterval(() => {
      // first update time labels
      renderHistory(); // re-render times (keeps it simple)
      checkHistoryFade();
    }, CHECK_INTERVAL);

    /* ======= Init UI ======= */
    updateDisplay();

    /* ======= Accessibility: focus on first number when load (optional) ======= */
    // find first numeric button and focus for keyboard users
    (function focusFirstNum(){
      const firstNum = document.querySelector('[data-action="num"]');
      if (firstNum) firstNum.tabIndex = 0;
    })();

    /* ======= Extra: clicking history item reapplies it ======= */
    historyListEl.addEventListener('click', (e) => {
      const li = e.target.closest('.history-item');
      if (!li) return;
      const ts = Number(li.dataset.ts);
      const item = history.find(h => h.timestamp === ts);
      if (!item) return;
      // reapply the result to the current operand
      currentOperand = String(item.result);
      previousOperand = '';
      operation = null;
      updateDisplay();
      status.textContent = 'Loaded from history';
      setTimeout(()=> status.textContent = 'Ready', 900);
    });
  </script>
</body>
</html>
